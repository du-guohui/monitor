global.webpackJsonp([2],{ENDi:function(t,e,i){"use strict";var o={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.cropper,expression:"!cropper"}],staticClass:"device-top"},[t.form?i("wux-cell-group",{attrs:{mpcomid:"3"}},[i("wux-cell",{staticClass:"input",attrs:{"hover-class":"none",mpcomid:"1"}},[i("wux-input",{attrs:{label:t.form.gatewayId?"网关位置：":"设备位置：",placeholder:t.form.gatewayId?"请输入网关位置信息":"请输入设备位置信息",id:"name",value:t.form.name,controlled:"",type:"text",eventid:"0",mpcomid:"0"},on:{change:t.onChange}})],1),t._v(" "),t.form.gatewayId?t._e():i("wux-cell",{staticClass:"input",attrs:{"hover-class":"none",eventid:"1",mpcomid:"2"},on:{click:t.onClick}},[i("div",{staticClass:"inputs"},[i("div",{staticClass:"title"},[t._v("分组：")]),t._v(" "),i("div",{staticClass:"txt"},[t._v(t._s(t.value))])])]),t._v(" "),t.form.gatewayId?t._e():i("div",{staticClass:"upload-img",attrs:{eventid:"2"},on:{click:function(e){t.uploadTap()}}},[i("div",{staticClass:"title"},[t._v("位置图片：")]),t._v(" "),i("div",{staticClass:"upload-ioc"},[t.img_url&&"null"!=t.img_url&&""!=t.img_url?i("img",{staticClass:"imgs",attrs:{src:t.serverUrl+t.img_url}}):i("img",{staticClass:"no-img",attrs:{src:"/static/img/12.png",alt:""}}),t._v(" "),i("div",{staticClass:"txt"},[t._v("点击上传图片")])])])],1):t._e()],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.cropper,expression:"!cropper"}],staticClass:"footer-button"},[i("div",{staticClass:"positive color1 buttons",attrs:{eventid:"3"},on:{click:t.PostData}},[t._v("保存")]),t._v(" "),t.edit?i("div",{staticClass:"calm buttons",attrs:{eventid:"4"},on:{click:t.Delete}},[t._v("删除")]):t._e()]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.cropper,expression:"cropper"}],staticClass:"test"},[i("div",{staticClass:"mpvue-cropper"},[i("mpvue-cropper",{ref:"cropper",attrs:{option:t.cropperOpt,eventid:"5",mpcomid:"4"},on:{ready:t.cropperReady,beforeDraw:t.cropperBeforeDraw,beforeImageLoad:t.cropperBeforeImageLoad,beforeLoad:t.cropperLoad}})],1),t._v(" "),i("div",{staticClass:"cropper-buttons"},[i("div",{staticClass:"upload btn",attrs:{eventid:"6"},on:{click:function(e){t.cropper=!1}}},[t._v("取消")]),t._v(" "),i("div",{staticClass:"getCropperImage btn",attrs:{eventid:"7"},on:{click:t.getCropperImage}},[t._v("保存")])])]),t._v(" "),i("wux-toast",{attrs:{id:"wux-toast",mpcomid:"5"}}),t._v(" "),i("wux-dialog",{attrs:{id:"wux-dialog",mpcomid:"6"}}),t._v(" "),i("wux-dialog",{attrs:{id:"wux-dialog--alert",mpcomid:"7"}}),t._v(" "),i("wux-select",{attrs:{id:"wux-select",mpcomid:"8"}}),t._v(" "),i("wux-loading",{attrs:{id:"wux-loading",mpcomid:"9"}})],1)},staticRenderFns:[]};e.a=o},T3TT:function(t,e,i){"use strict";var o=i("t+zF"),r=i("ENDi");var a=function(t){i("oYWV")},s=i("ybqe")(o.a,r.a,a,"data-v-3bc345b2",null);e.a=s.exports},Y2v8:function(t,e,i){"use strict";var o=i("ugYC"),r=i("pE17");var a=function(t){i("ezLG")},s=i("ybqe")(o.a,r.a,a,null,null);e.a=s.exports},ezLG:function(t,e){},oYWV:function(t,e){},pE17:function(t,e,i){"use strict";var o={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._canvasId?i("canvas",{style:{width:t._width+"px",height:t._height+"px",background:"rgba(0, 0, 0, .8)"},attrs:{canvasId:t._canvasId,"disable-scroll":"",eventid:"0"},on:{touchstart:t.touchstart,touchmove:t.touchmove,touchend:t.touchend}}):t._e(),t._v(" "),t._targetId?i("canvas",{style:{position:"fixed",top:-t._width*t._pixelRatio+"px",left:-t._height*t._pixelRatio+"px",width:t._width*t._pixelRatio+"px",height:t._height*t._pixelRatio+"px"},attrs:{"canvas-id":t._targetId,"disable-scroll":""}}):t._e()])},staticRenderFns:[]};e.a=o},"t+zF":function(t,e,i){"use strict";var o=i("2FZb"),r=i("olkN"),a=i("Y2v8"),s=void 0,n=wx.getSystemInfoSync(),c=n.windowWidth,u=n.windowHeight;e.a={computed:{DeviceList:function(){return r.a.state.Data.Device}},data:function(){return{value:"",group:[],groupIndex:0,cropper:!1,edit:!1,serverUrl:"",form:"",img_url:"",cropperOpt:{id:"cropper",targetId:"targetCropper",pixelRatio:n.pixelRatio,width:c,height:u,scale:2.5,zoom:8,cut:{x:(c-320)/2,y:(u-180)/2,width:320,height:180}}}},components:{MpvueCropper:a.a},methods:{cropperReady:function(){console.log("cropper ready!")},cropperBeforeImageLoad:function(){console.log("before image load")},cropperLoad:function(){console.log("image loaded")},cropperBeforeDraw:function(){},uploadTap:function(){var t=this;wx.chooseImage({count:2,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){var i=e.tempFilePaths[0];s.pushOrigin(i),t.cropper=!0}})},getCropperImage:function(){var t=this;s.getCropperImage().then(function(e){wx.uploadFile({url:t.$url+"/device/addEnvImg",filePath:e,name:"img",header:{Authorization:wx.getStorageSync("Authorization")},success:function(e){t.cropper=!1,200==e.statusCode?(t.img_url=JSON.parse(e.data).content,t.Toast("success","上传图片成功")):t.Toast("forbidden","上传失败，请重新上传")}}).onProgressUpdate(function(t){console.log("上传进度",t.progress),console.log("已经上传的数据长度",t.totalBytesSent),console.log("预期需要上传的数据总长度",t.totalBytesExpectedToSend)})}).catch(function(t){console.error("获取图片失败")})},GetData:function(){var t=this.$route.query.id,e=this.$route.query.editId;if(this.serverUrl=this.$url,t)for(var i in this.edit=!0,this.DeviceList)for(var o in this.DeviceList[i].device_list)this.DeviceList[i].device_list[o].id==t&&(this.form=this.DeviceList[i].device_list[o]);else e?(this.edit=!0,this.form=this.$route.query):(this.edit=!1,this.form=this.$route.query);if(this.$route.query.gatewayId)wx.setNavigationBarTitle({title:""==this.$route.query.name?"添加网关":"网关修改"});else{for(var r in wx.setNavigationBarTitle({title:t?"设备修改":"添加设备"}),this.DeviceList)this.group.push(this.DeviceList[r].group.name);if(this.form.device_group_id)for(var a in this.DeviceList)this.DeviceList[a].group.id==this.form.device_group_id&&(this.value=this.DeviceList[a].group.name,this.groupIndex=a);else this.value=this.DeviceList[0].group.name}},PostData:function(){var t=this;""!=this.form.name?this.form.gatewayId?this.ajax(this.$route.query.editId?"device/updateGateway":"device/addGateway",{name:this.form.name,mac:this.form.gatewayId,id:this.form.editId},"POST").then(function(e){"success"==e.content?(t.Toast("success",t.$route.query.editId?"修改成功":"添加成功"),setTimeout(function(){wx.switchTab({url:"/pages/list/index"}),r.a.commit("GatewayList",t)},1500)):t.Toast("forbidden",e.msg)}):this.ajax(this.$route.query.id?"device/updateDevice":"device/addDevice",{id:this.form.id,appKey:this.form.appKey,devEui:this.form.devEui,name:this.form.name,img_url:this.img_url,device_group_id:this.DeviceList[this.groupIndex].group.id},"POST").then(function(e){"success"==e.content?(t.Toast("success",t.$route.query.id?"修改成功":"添加成功"),setTimeout(function(){wx.switchTab({url:"/pages/list/index"}),r.a.commit("DeviceList",t)},1500)):t.Toast("forbidden",e.msg)}):this.Toast("forbidden",this.form.gatewayId?"网关位置信息":"位置名称不能为空")},Delete:function(){var t=this;Object(o.b)().alert({resetOnClose:!0,title:"删除确认",content:"是否删除该设备/网关?",buttons:[{text:"取消"},{text:"确定",type:"primary",onTap:function(e){t.ajax(t.form.gatewayId?"device/deleteGateway":"device/deleteDevice",{id:t.form.gatewayId?t.form.editId:t.form.id},"POST").then(function(e){"success"==e.content?(t.Toast("success","删除成功"),setTimeout(function(){wx.switchTab({url:"/pages/list/index"}),t.form.gatewayId?r.a.commit("GatewayList",t):r.a.commit("DeviceList",t)},1500)):t.Toast("forbidden","服务器错误")})}}]})},onChange:function(t){this.form[t.mp.currentTarget.id]=t.mp.detail.value},onClick:function(){var t=this;Object(o.d)("#wux-select").open({value:t.value,options:t.group,onConfirm:function(e,i,o){-1!==i&&(t.value=e,t.groupIndex=i)}})}},mounted:function(){this.form="",this.group=[],this.groupIndex=0,this.value="",this.cropper=!1,this.img_url="",this.$route.query.img_url&&(this.img_url=this.$route.query.img_url),s=this.$refs.cropper,this.GetData()}}},ugYC:function(t,e,i){"use strict";var o=i("woOf"),r=i.n(o),a=i("//Fk"),s=i.n(a),n=i("gNB4"),c=i.n(n);e.a={name:"mpvue-cropper",props:{option:{type:Object}},data:function(){return{_wecropper:null}},computed:{_canvasId:function(){return this.option.id},_targetId:function(){return this.option.targetId},_width:function(){return this.option.width},_height:function(){return this.option.height},_pixelRatio:function(){return this.option.pixelRatio}},methods:{touchstart:function(t){this._wecropper.touchStart(t.mp)},touchmove:function(t){this._wecropper.touchMove(t.mp)},touchend:function(t){this._wecropper.touchEnd(t.mp)},pushOrigin:function(t){this._wecropper.pushOrign(t)},updateCanvas:function(){this._wecropper.updateCanvas()},getCropperBase64:function(){var t=this;return new s.a(function(e,i){t._wecropper.getCropperImage(function(t){t?e(t):i()})})},getCropperImage:function(){var t=this;return new s.a(function(e,i){t._wecropper.getCropperImage(function(t){t?e(t):i()})})},init:function(){var t=this;this._wecropper=new c.a(r()(this.option,{id:this._canvasId,targetId:this._targetId,pixelRatio:this._pixelRatio})).on("ready",function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];t.$emit.apply(t,["ready"].concat(i))}).on("beforeImageLoad",function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];t.$emit.apply(t,["beforeImageLoad"].concat(i))}).on("imageLoad",function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];t.$emit.apply(t,["imageLoad"].concat(i))}).on("beforeDraw",function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];t.$emit.apply(t,["beforeDraw"].concat(i))})}},onLoad:function(){if(!this.option)return console.warn("[mpvue-cropper] 请传入option参数\n参数配置见文档：https://we-plugin.github.io/we-cropper/#/api");this.init()}}}},["HKXx"]);