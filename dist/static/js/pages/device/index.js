global.webpackJsonp([1],{ENDi:function(t,e,o){"use strict";var i={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"container"},[o("div",{directives:[{name:"show",rawName:"v-show",value:!t.cropper,expression:"!cropper"}],staticClass:"device-top"},[t.form?o("wux-cell-group",{attrs:{mpcomid:"2"}},[o("wux-cell",{staticClass:"input",attrs:{"hover-class":"none",mpcomid:"1"}},[o("wux-input",{attrs:{label:t.form.gatewayId?"网关位置：":"设备位置：",placeholder:t.form.gatewayId?"请输入网关位置信息":"请输入设备位置信息",id:"name",value:t.form.name,controlled:"",type:"text",eventid:"0",mpcomid:"0"},on:{change:t.onChange}})],1),t._v(" "),t.form.gatewayId?t._e():o("div",{staticClass:"upload-img",attrs:{eventid:"1"},on:{click:function(e){t.uploadTap()}}},[o("div",{staticClass:"title"},[t._v("位置图片：")]),t._v(" "),o("div",{staticClass:"upload-ioc"},[t.img_url?o("img",{staticClass:"imgs",attrs:{src:t.serverUrl+t.img_url}}):o("img",{staticClass:"no-img",attrs:{src:"/static/img/12.png",alt:""}}),t._v(" "),o("div",{staticClass:"txt"},[t._v("点击上传图片")])])])],1):t._e()],1),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!t.cropper,expression:"!cropper"}],staticClass:"footer-button"},[o("div",{staticClass:"positive color1 buttons",attrs:{eventid:"2"},on:{click:t.PostData}},[t._v("保存")]),t._v(" "),t.edit?o("div",{staticClass:"calm buttons",attrs:{eventid:"3"},on:{click:t.Delete}},[t._v("删除")]):t._e()]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.cropper,expression:"cropper"}],staticClass:"test"},[o("div",{staticClass:"mpvue-cropper"},[o("mpvue-cropper",{ref:"cropper",attrs:{option:t.cropperOpt,eventid:"4",mpcomid:"3"},on:{ready:t.cropperReady,beforeDraw:t.cropperBeforeDraw,beforeImageLoad:t.cropperBeforeImageLoad,beforeLoad:t.cropperLoad}})],1),t._v(" "),o("div",{staticClass:"cropper-buttons"},[o("div",{staticClass:"upload btn",attrs:{eventid:"5"},on:{click:function(e){t.cropper=!1}}},[t._v("取消")]),t._v(" "),o("div",{staticClass:"getCropperImage btn",attrs:{eventid:"6"},on:{click:t.getCropperImage}},[t._v("保存")])])]),t._v(" "),o("wux-toast",{attrs:{id:"wux-toast",mpcomid:"4"}}),t._v(" "),o("wux-dialog",{attrs:{id:"wux-dialog",mpcomid:"5"}}),t._v(" "),o("wux-dialog",{attrs:{id:"wux-dialog--alert",mpcomid:"6"}})],1)},staticRenderFns:[]};e.a=i},T3TT:function(t,e,o){"use strict";var i=o("t+zF"),r=o("ENDi");var a=function(t){o("oYWV")},n=o("ybqe")(i.a,r.a,a,"data-v-3bc345b2",null);e.a=n.exports},Y2v8:function(t,e,o){"use strict";var i=o("ugYC"),r=o("pE17");var a=function(t){o("ezLG")},n=o("ybqe")(i.a,r.a,a,null,null);e.a=n.exports},ezLG:function(t,e){},oYWV:function(t,e){},pE17:function(t,e,o){"use strict";var i={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t._canvasId?o("canvas",{style:{width:t._width+"px",height:t._height+"px",background:"rgba(0, 0, 0, .8)"},attrs:{canvasId:t._canvasId,"disable-scroll":"",eventid:"0"},on:{touchstart:t.touchstart,touchmove:t.touchmove,touchend:t.touchend}}):t._e(),t._v(" "),t._targetId?o("canvas",{style:{position:"fixed",top:-t._width*t._pixelRatio+"px",left:-t._height*t._pixelRatio+"px",width:t._width*t._pixelRatio+"px",height:t._height*t._pixelRatio+"px"},attrs:{"canvas-id":t._targetId,"disable-scroll":""}}):t._e()])},staticRenderFns:[]};e.a=i},"t+zF":function(t,e,o){"use strict";var i=o("2FZb"),r=o("olkN"),a=o("Y2v8"),n=void 0,s=wx.getSystemInfoSync(),c=s.windowWidth,u=s.windowHeight;e.a={computed:{DeviceList:function(){return r.a.state.DeviceList}},data:function(){return{cropper:!1,edit:!1,serverUrl:"",form:"",img_url:"",cropperOpt:{id:"cropper",targetId:"targetCropper",pixelRatio:s.pixelRatio,width:c,height:u,scale:2.5,zoom:8,cut:{x:(c-320)/2,y:(u-180)/2,width:320,height:180}}}},components:{MpvueCropper:a.a},methods:{cropperReady:function(){console.log("cropper ready!")},cropperBeforeImageLoad:function(){console.log("before image load")},cropperLoad:function(){console.log("image loaded")},cropperBeforeDraw:function(){},uploadTap:function(){var t=this;wx.chooseImage({count:2,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){var o=e.tempFilePaths[0];n.pushOrigin(o),t.cropper=!0}})},getCropperImage:function(){var t=this;n.getCropperImage().then(function(e){wx.uploadFile({url:t.$url+"/device/addEnvImg",filePath:e,name:"img",header:{Authorization:wx.getStorageSync("Authorization")},success:function(e){t.cropper=!1,200==e.statusCode?(t.img_url=JSON.parse(e.data).content,t.form.img_url=JSON.parse(e.data).content,t.Toast("success","上传图片成功")):t.Toast("forbidden","上传失败，请重新上传")}}).onProgressUpdate(function(t){console.log("上传进度",t.progress),console.log("已经上传的数据长度",t.totalBytesSent),console.log("预期需要上传的数据总长度",t.totalBytesExpectedToSend)})}).catch(function(t){console.error("获取图片失败")})},GetData:function(){var t=this.$route.query.id,e=this.$route.query.editId;if(this.serverUrl=this.$url,t)for(var o in this.edit=!0,this.DeviceList)this.DeviceList[o].id==t&&(this.form=this.DeviceList[o]);else e?(this.edit=!0,this.form=this.$route.query):(this.edit=!1,this.form=this.$route.query);this.$route.query.gatewayId?wx.setNavigationBarTitle({title:""==this.$route.query.name?"添加网关":"网关修改"}):wx.setNavigationBarTitle({title:t?"设备修改":"添加设备"})},PostData:function(){var t=this;""!=this.form.name?this.form.gatewayId?this.ajax(this.$route.query.editId?"device/updateGateway":"device/addGateway",{name:this.form.name,mac:this.form.gatewayId,id:this.form.editId},"POST").then(function(e){if("success"!=e.content)return"1062"==e.code?void t.Toast("forbidden","操作失败,该设备已存在！"):"1404"==e.code?void t.Toast("forbidden","操作失败,该设备不存在！"):void t.Toast("forbidden","操作失败");t.Toast("success",t.$route.query.editId?"修改成功":"添加成功"),setTimeout(function(){wx.navigateBack(1)},1500)}):this.ajax(this.$route.query.id?"device/updateDevice":"device/addDevice",this.form,"POST").then(function(e){if("success"!=e.content)return"1062"==e.code?void t.Toast("forbidden","操作失败,该设备已存在！"):"1404"==e.code?void t.Toast("forbidden","操作失败,该设备不存在！"):void t.Toast("forbidden","操作失败");t.Toast("success",t.$route.query.id?"修改成功":"添加成功"),r.a.commit("ChangeList"),setTimeout(function(){wx.navigateBack(1)},1500)}):this.Toast("forbidden",this.form.gatewayId?"网关位置信息":"位置名称不能为空")},Delete:function(){var t=this;Object(i.b)().alert({resetOnClose:!0,title:"删除确认",content:"是否删除该设备？",buttons:[{text:"取消"},{text:"确定",type:"primary",onTap:function(e){t.ajax(t.form.gatewayId?"device/deleteGateway":"device/deleteDevice",{id:t.form.gatewayId?t.form.editId:t.form.id},"POST").then(function(e){"success"==e.content?(t.Toast("success","删除成功"),t.form.gatewayId?setTimeout(function(){wx.navigateBack(1)},1500):(r.a.commit("ChangeList"),setTimeout(function(){wx.switchTab({url:"/pages/list/index"})},1500))):t.Toast("forbidden","服务器错误")})}}]})},onChange:function(t){this.form[t.mp.currentTarget.id]=t.mp.detail.value}},onShow:function(){this.cropper=!1,this.img_url="",this.GetData(),this.$route.query.img_url&&(this.img_url=this.$route.query.img_url,this.form.img_url=this.$route.query.img_url)},mounted:function(){n=this.$refs.cropper}}},ugYC:function(t,e,o){"use strict";var i=o("woOf"),r=o.n(i),a=o("//Fk"),n=o.n(a),s=o("gNB4"),c=o.n(s);e.a={name:"mpvue-cropper",props:{option:{type:Object}},data:function(){return{_wecropper:null}},computed:{_canvasId:function(){return this.option.id},_targetId:function(){return this.option.targetId},_width:function(){return this.option.width},_height:function(){return this.option.height},_pixelRatio:function(){return this.option.pixelRatio}},methods:{touchstart:function(t){this._wecropper.touchStart(t.mp)},touchmove:function(t){this._wecropper.touchMove(t.mp)},touchend:function(t){this._wecropper.touchEnd(t.mp)},pushOrigin:function(t){this._wecropper.pushOrign(t)},updateCanvas:function(){this._wecropper.updateCanvas()},getCropperBase64:function(){var t=this;return new n.a(function(e,o){t._wecropper.getCropperImage(function(t){t?e(t):o()})})},getCropperImage:function(){var t=this;return new n.a(function(e,o){t._wecropper.getCropperImage(function(t){t?e(t):o()})})},init:function(){var t=this;this._wecropper=new c.a(r()(this.option,{id:this._canvasId,targetId:this._targetId,pixelRatio:this._pixelRatio})).on("ready",function(){for(var e=arguments.length,o=Array(e),i=0;i<e;i++)o[i]=arguments[i];t.$emit.apply(t,["ready"].concat(o))}).on("beforeImageLoad",function(){for(var e=arguments.length,o=Array(e),i=0;i<e;i++)o[i]=arguments[i];t.$emit.apply(t,["beforeImageLoad"].concat(o))}).on("imageLoad",function(){for(var e=arguments.length,o=Array(e),i=0;i<e;i++)o[i]=arguments[i];t.$emit.apply(t,["imageLoad"].concat(o))}).on("beforeDraw",function(){for(var e=arguments.length,o=Array(e),i=0;i<e;i++)o[i]=arguments[i];t.$emit.apply(t,["beforeDraw"].concat(o))})}},onLoad:function(){if(!this.option)return console.warn("[mpvue-cropper] 请传入option参数\n参数配置见文档：https://we-plugin.github.io/we-cropper/#/api");this.init()}}}},["HKXx"]);